<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="1187.4">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000ee}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica}
p.p6 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p7 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica}
p.p8 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p9 {margin: 0.0px 0.0px 0.0px 85.0px; text-indent: -85.0px; font: 12.0px Helvetica}
p.p10 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica}
p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c00}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #cd1c00; min-height: 12.0px}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Monaco; min-height: 16.0px}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0326cb}
p.p16 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco}
p.p17 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; color: #cd1c00}
p.p18 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; color: #0326cb}
span.s1 {font: 18.0px Helvetica}
span.s2 {color: #000000}
span.s3 {text-decoration: underline}
span.s4 {text-decoration: underline ; color: #042eee}
span.s5 {color: #00bbff}
span.s6 {color: #0326cb}
span.s7 {color: #0433ff}
span.s8 {color: #434ccb}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>ZeroXBufWr<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><b>writes zero crossing analysis from signals to buffers</b></p>
<p class="p2"><br></p>
<p class="p3"><span class="s2"><b>Part of:</b> <a href="../miSCellaneous.html"><span class="s3">miSCellaneous</span></a></span></p>
<p class="p2"><br></p>
<p class="p1"><b>Inherits from: UGen</b></p>
<p class="p4"><br></p>
<p class="p1">ZeroXBufWr analyses zero crossings from an input signal and writes the signal and the zero crossing indices to buffers. It is intended to be used with <a href="../ZeroXBufRd.html"><span class="s4">ZeroXBufRd</span></a> and <a href="../TZeroXBufRd.html"><span class="s4">TZeroXBufRd</span></a>, see these help files for more examples.</p>
<p class="p2"><br></p>
<p class="p1"><b>NOTE: </b>Often it pays to adjust zero crossings in the sound buffer effectively to 0, that way sawtooth-like interpolation artefacts can be avoided. See Ex. 2 and Ex. 7 in ZeroXBufRd help..</p>
<p class="p2"><br></p>
<p class="p1"><b>NOTE: </b>For avoiding too long half wavesets it can be useful to apply LeakDC resp. a high pass filter before analysis.</p>
<p class="p2"><br></p>
<p class="p1"><b>NOTE: </b>For full functionality at least SC 3.7 is recommended (adjustZeroXs set to 2 doesn't work in 3.6)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><b>CREDITS: </b>Thanks to Tommaso Settimi for an inspiring discussion, which gave me a nudge to tackle these classes.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><span class="s2"><b>See also: </b><a href="../ZeroXBufRd.html"><span class="s3">ZeroXBufRd</span></a>,<b> </b><a href="../TZeroXBufWr.html"><span class="s3">TZeroXBufWr</span></a>,<b> </b><a href="../DX suite.html"><span class="s3">DX suite</span></a>,<b> </b><a href="../DXMix.html"><span class="s3">DXMix</span></a>, <a href="../DXMixIn.html"><span class="s3">DXMixIn</span></a>, <a href="../DXEnvFan.html"><span class="s3">DXEnvFan</span></a>,<b> </b><a href="../DXEnvFanOut.html"><span class="s3">DXEnvFanOut</span></a>, <a href="../DXFanOut.html"><span class="s3">DXFanOut</span></a>, <a href="../Buffer Granulation.html"><span class="s3">Buffer Granulation</span></a>, <a href="../Live Granulation.html"><span class="s3">Live Granulation</span></a>, <a href="../PbindFx.html"><span class="s3">PbindFx</span></a></span><span class="s5">,</span><span class="s2"> <a href="../kitchen studies.html"><span class="s3">kitchen studies</span></a></span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p5"><b>Creation / Class Methods</b></p>
<p class="p6"><br></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>*ar (in, sndBuf, zeroXBuf, startWithZeroX = 0, adjustZeroXs = 1, doneAction = 0)</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>in </b>- Signal to be analysed, size must correspond to <b>sndBuf </b>and <b>zeroXBuf</b>.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>sndBuf </b>- Buffer or SequenceableCollection of Buffers to write signals to,<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>size must correspond to <b>in </b>and<b> zeroXBuf</b>, writing can be disabled with <b>writeSndBuf</b>.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>The length of <b>sndBuf</b> determines the trigger for the doneAction.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>zeroXBuf </b>- Buffer or SequenceableCollection of Buffers to write anaysis data to,<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>size must correspond to <b>in </b>and<b> sndBuf</b>.<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>startWithZeroX </b>- Number 0 or 1 or SequenceableCollection of such,<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>determining whether the first sample should be regarded as zero crossing.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Defaults to 0.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>adjustZeroXs </b>- One of the Numbers -1, 0, 1, 2 or a SequenceableCollection of such.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>-1:<span class="Apple-converted-space">  </span>indicate all zeroXs, dont't write sound buffer</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0:<span class="Apple-converted-space">  </span>indicate all zeroXs, write sound buffer</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>1:<span class="Apple-converted-space">  </span>indicate all zeroXs, write sound buffer, set to 0 there</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>2:<span class="Apple-converted-space">  </span>indicate zeroXs with a minimum distance of 2, set to 0 there</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Actions 1 and 2 can lead to smoother half wavesets, see examples.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Defaults to 0.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>doneAction </b>- Done action to be performed after the duration of the longest buffer of <b>sndBuf</b>.<span class="Apple-converted-space"> </span></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Defaults to 0.<span class="Apple-converted-space"> <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p8"><br></p>
<p class="p10"><b>Examples</b></p>
<p class="p8"><br></p>
<p class="p11">// See the ZeroXBufRd and TZeroXBufRd help files for more examples</p>
<p class="p12"><br></p>
<p class="p8"><br></p>
<p class="p10"><b>Ex.1) Basic usage</b></p>
<p class="p13"><br></p>
<p class="p11">// prepare two short buffers for audio and zero crossing data</p>
<p class="p4"><br></p>
<p class="p14">(</p>
<p class="p14">b = <span class="s6">Buffer</span>.alloc(s, 256);</p>
<p class="p14">z = <span class="s6">Buffer</span>.alloc(s, 256);</p>
<p class="p14">)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p11">// analyse a short snippet of random noise</p>
<p class="p4"><br></p>
<p class="p14">(</p>
<p class="p14">{</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="s7">var</span> src = <span class="s6">LFDNoise3</span>.ar(5000);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="s6">ZeroXBufWr</span>.ar(src, b, z, startWithZeroX: 0, doneAction: 2);</p>
<p class="p15"><span class="s2"><span class="Apple-tab-span">	</span></span>Silent<span class="s2">.ar</span></p>
<p class="p14">}.play</p>
<p class="p14">)</p>
<p class="p4"><br></p>
<p class="p11">// plot buffer, most likely it doesn't start with 0</p>
<p class="p4"><br></p>
<p class="p14">b.plot</p>
<p class="p4"><br></p>
<p class="p11">// zero crossings</p>
<p class="p4"><br></p>
<p class="p14">z.loadToFloatArray(action: { <span class="s7">|b|</span> b.postln })</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p11">// clear buffers</p>
<p class="p4"><br></p>
<p class="p14">(</p>
<p class="p14">b.zero;</p>
<p class="p14">z.zero;</p>
<p class="p14">)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p11">// example with SinOsc</p>
<p class="p11">// other than you might expect SinOsc doesn't start with 0</p>
<p class="p11">// for analysis you might want to regard the value at index 0 as zero crossing</p>
<p class="p11">// this can be done with the flag startWithZeroX:</p>
<p class="p4"><br></p>
<p class="p14">(</p>
<p class="p14">{</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="s7">var</span> src = <span class="s6">SinOsc</span>.ar(500);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="s6">ZeroXBufWr</span>.ar(src, b, z, startWithZeroX: 1, doneAction: 2);</p>
<p class="p15"><span class="s2"><span class="Apple-tab-span">	</span></span>Silent<span class="s2">.ar</span></p>
<p class="p14">}.play</p>
<p class="p14">)</p>
<p class="p4"><br></p>
<p class="p11">// plot buffer, you see that it doesn't start with 0</p>
<p class="p4"><br></p>
<p class="p14">b.plot</p>
<p class="p4"><br></p>
<p class="p11">// zero crossings including start</p>
<p class="p4"><br></p>
<p class="p14">z.loadToFloatArray(action: { <span class="s7">|b|</span> b.postln })</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p10"><b>Ex.2) Adjusting zero crossings</b></p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p16">(</p>
<p class="p16">b = <span class="s6">Buffer</span>.alloc(s, 128);</p>
<p class="p16">z = <span class="s6">Buffer</span>.alloc(s, 128);</p>
<p class="p16">)</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p16">s.scope</p>
<p class="p6"><br></p>
<p class="p17">// fill buffer</p>
<p class="p6"><br></p>
<p class="p16">(</p>
<p class="p16">{</p>
<p class="p16"><span class="Apple-tab-span">	</span><span class="s7">var</span> src = <span class="s6">LFPar</span>.ar(700);</p>
<p class="p16"><span class="Apple-tab-span">	</span><span class="s6">ZeroXBufWr</span>.ar(src, b, z, startWithZeroX: 1, doneAction: 2);</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>Silent<span class="s2">.ar</span></p>
<p class="p16">}.play</p>
<p class="p16">)</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p17">// playing this repeated half waveset at slow rate shows that the x axis is crossed</p>
<p class="p17">// as the buffer's value at the zero crossing isn't exactly 0</p>
<p class="p6"><br></p>
<p class="p16">x = { <span class="s6">ZeroXBufRd</span>.ar(b, z, <span class="s8">nil</span>, 1, rate: 0.2) * 0.1 }.play</p>
<p class="p6"><br></p>
<p class="p17">// this can be circumvented by two strategies:</p>
<p class="p6"><br></p>
<p class="p17">// setting to zeros from the language</p>
<p class="p17">// can be done while running</p>
<p class="p6"><br></p>
<p class="p16">b.adjustZeroXs(z)</p>
<p class="p6"><br></p>
<p class="p16">x.release</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p17">// alternatively writing can be done with the flag 'adjustZeroXs' set to 1:</p>
<p class="p6"><br></p>
<p class="p16">(</p>
<p class="p16">{</p>
<p class="p16"><span class="Apple-tab-span">	</span><span class="s7">var</span> src = <span class="s6">LFPar</span>.ar(700);</p>
<p class="p16"><span class="Apple-tab-span">	</span><span class="s6">ZeroXBufWr</span>.ar(src, b, z, startWithZeroX: 1, adjustZeroXs: 1, doneAction: 2);</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>Silent<span class="s2">.ar</span></p>
<p class="p16">}.play</p>
<p class="p16">)</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p16">x = { <span class="s6">ZeroXBufRd</span>.ar(b, z, <span class="s8">nil</span>, 1, rate: 0.2) * 0.1 }.play</p>
<p class="p6"><br></p>
<p class="p16">x.release</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p17">// If flag 'adjustZeroXs' is set to 2, this defines the minimum distance of detected zero crossings,</p>
<p class="p17">// these positions in the buffer are also set to 0.</p>
<p class="p17">// This option can make sense in the case of sources with many fast sign switchings.</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p17">// here the resulting buffer can end up with sequences of zeros ...</p>
<p class="p16">(</p>
<p class="p16">{</p>
<p class="p16"><span class="Apple-tab-span">	</span><span class="s7">var</span> seq = <span class="s6">Drand</span>([1, 1, 2, 3], <span class="s8">inf</span>);</p>
<p class="p16"><span class="Apple-tab-span">	</span><span class="s7">var</span> src = <span class="s6">Duty</span>.ar(<span class="s6">SampleDur</span>.ir * seq, 0, <span class="s6">Dwhite</span>(0.1, 1) * <span class="s6">Dseq</span>([-1, 1], <span class="s8">inf</span>));</p>
<p class="p16"><span class="Apple-tab-span">	</span><span class="s6">ZeroXBufWr</span>.ar(src, b, z, startWithZeroX: 1, adjustZeroXs: 1, doneAction: 2);</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>Silent<span class="s2">.ar</span></p>
<p class="p16">}.play</p>
<p class="p16">)</p>
<p class="p6"><br></p>
<p class="p16">b.plot</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p17">// ... whereas here we have a continuous sequence of at least minimal half wavesets</p>
<p class="p6"><br></p>
<p class="p16">(</p>
<p class="p16">{</p>
<p class="p16"><span class="Apple-tab-span">	</span><span class="s7">var</span> seq = <span class="s6">Drand</span>([1, 1, 2, 3], <span class="s8">inf</span>);</p>
<p class="p16"><span class="Apple-tab-span">	</span><span class="s7">var</span> src = <span class="s6">Duty</span>.ar(<span class="s6">SampleDur</span>.ir * seq, 0, <span class="s6">Dwhite</span>(0.1, 1) * <span class="s6">Dseq</span>([-1, 1], <span class="s8">inf</span>));</p>
<p class="p16"><span class="Apple-tab-span">	</span><span class="s6">ZeroXBufWr</span>.ar(src, b, z, startWithZeroX: 1, adjustZeroXs: 2, doneAction: 2);</p>
<p class="p18"><span class="s2"><span class="Apple-tab-span">	</span></span>Silent<span class="s2">.ar</span></p>
<p class="p16">}.play</p>
<p class="p16">)</p>
<p class="p6"><br></p>
<p class="p16">b.plot</p>
<p class="p6"><br></p>
<p class="p17">// This can especially make a difference with ZeroXBufRd, as the latter works with</p>
<p class="p17">// a minimum half waveset length of 2 samples</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p6"><br></p>
</body>
</html>
